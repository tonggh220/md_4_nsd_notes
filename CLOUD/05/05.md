# 容器技术 -- 1

## docker安装

#### 安装前准备：

​    1、禁用 selinux  [SELINUX=disabled]

​    2、卸载防火墙    [yum -y remove firewalld-*]

​    3、docker软件安装包在  云盘\kubernetes\docker 目录下，将 docker 目录上传到跳板机

​    4、准备 2 台 2cpu，2G内存的云主机

​              192.168.1.31    node-0001

​              192.168.1.32    node-0002

#### 跳板机yum源添加docker软件

```shell
[root@ecs-proxy ~]# cp -a docker /var/ftp/localrepo/ 
[root@ecs-proxy ~]# cd /var/ftp/localrepo/
[root@ecs-proxy localrepo]# createrepo --update .
```

#### 在 node 节点验证软件包

```shell
[root@node-0001 ~]# yum makecache
[root@node-0001 ~]# yum list docker-ce*
```

以下操作所有 node 节点都需要执行

#### 开启路由转发

```shell
[root@node-0001 ~]# vim /etc/sysctl.conf
net.ipv4.ip_forward = 1
[root@node-0001 ~]# sysctl -p
```

```shell
[root@node-0001 ~]# yum install -y docker-ce
[root@node-0001 ~]# systemctl enable --now docker
[root@node-0001 ~]# ifconfig # 验证，能看见 docker0
[root@node-0001 ~]# docker version # 验证，没有报错
```

#### 开放 FORWARD 默认规则

```shell
[root@node-0001 ~]# vim /lib/systemd/system/docker.service
# 在 ExecStart 下面添加
ExecStartPost=/sbin/iptables -P FORWARD ACCEPT
[root@node-0001 ~]# systemctl daemon-reload
[root@node-0001 ~]# systemctl restart docker
[root@node-0001 ~]# iptables -nL FORWARD
```

## 镜像管理&容器管理

#### docker镜像管理命令

**docker images** 查看本机镜像
**docker  search** 查找镜像（官方仓库）
**docker  pull**      下载镜像
**docker  push**    上传镜像
**docker  save**     备份镜像为tar包
**docker  load**     导入备份的镜像文件

导入 centos  nginx  redis  ubuntu 四个镜像到 node 节点

镜像素材在云盘的 kubernetes/docker-images/ 目录下

```shell
[root@node-0001 ~]# docker load -i centos.tar.gz
[root@node-0001 ~]# docker load -i nginx.tar.gz
[root@node-0001 ~]# docker load -i redis.tar.gz
[root@node-0001 ~]# docker load -i ubuntu.tar.gz
[root@node-0001 ~]# docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
redis               latest              82629e941a38        18 months ago       95MB
nginx               latest              42b4762643dc        18 months ago       109MB
ubuntu              latest              20bb25d32758        18 months ago       87.5MB
centos              latest              76d6bc25b8a5        21 months ago       200MB
```

