# kubernetes -- 02

## kubernetes 基础管理

#### kubectl 命令

###### 命令说明

| 命令格式                                            | 命令说明                             |
| --------------------------------------------------- | ------------------------------------ |
| kubectl run 资源名称 -参数 --image=镜像名称:标签    | 创建资源对象，常用参数-i交互，-t终端 |
| kubectl get 查询资源  可选参数 -o wide 显示主机信息 | 常用查询的资源 node\|deployment\|pod |
| kubectl exec -it 容器id  执行的命令                 | 同 docker exec 指令，进入容器内      |
| kubectl describe 资源类型  资源名称                 | 查询资源的详细信息                   |
| kubectl attach                                      | 同 docker attach 指令，连接容器      |
| kubectl logs 容器id                                 | 查看容器控制台的标准输出             |
| kubectl delete 资源类型  资源名称                   | 删除指定的资源                       |
| kubectl create\|apply  -f 资源文件                  | 执行指定的资源文件                   |

###### 命令案例

```shell
# 执行指定的资源文件
[root@master flannel]# kubectl apply -f kube-flannel.yml

# get 查询信息
[root@master ~]# kubectl get nodes
NAME        STATUS   ROLES    AGE   VERSION
master      Ready    master   19h   v1.17.6
node-0001   Ready    <none>   16h   v1.17.6
[root@master ~]# kubectl -n kube-system get pod
NAME                             READY   STATUS    RESTARTS   AGE
kube-flannel-ds-amd64-hf2jp      1/1     Running   0          41m
kube-flannel-ds-amd64-rtl4l      1/1     Running   0          41m
... ...

# describe 查询详细信息
[root@master ~]# kubectl -n kube-system describe pod kube-flannel-ds-amd64-rtl4l
Name:                 kube-proxy-4tbp6
Namespace:            kube-system
... ...

# 使用run启动容器
[root@master ~]# kubectl run testos -it --image=192.168.1.100:5000/myos:latest 
kubectl run --generator=deployment/apps.v1 is DEPRECATED and will be removed in a future version. Use kubectl run --generator=run-pod/v1 or kubectl create instead.
If you don't see a command prompt, try pressing enter.
[root@testos-79778b4895-s8mxl /]# 
# 启动服务
[root@master ~]# kubectl run web-test --image=192.168.1.100:5000/myos:httpd
kubectl run --generator=deployment/apps.v1 is DEPRECATED and will be removed in a future version. Use kubectl run --generator=run-pod/v1 or kubectl create instead.
deployment.apps/web-test created
# 访问节点
[root@master ~]# kubectl get pod -o wide
NAME                        READY   STATUS    RESTARTS   AGE     IP
testos-79778b4895-s8mxl     1/1     Running   1          6m33s   10.244.3.2   ... ...
web-test-7bf98b9576-v566c   1/1     Running   0          4m24s   10.244.4.2   ... ...
[root@master ~]# curl http://10.244.4.2/info.php
<pre>
Array
(
    [REMOTE_ADDR] => 10.244.0.0
    [REQUEST_METHOD] => GET
    [HTTP_USER_AGENT] => curl/7.29.0
    [REQUEST_URI] => /info.php
)
php_host: 	web-test-7bf98b9576-v566c
1229

# 进入容器
[root@master ~]# kubectl exec -it testos-79778b4895-s8mxl -- /bin/bash
[root@testos-79778b4895-s8mxl /]# 
[root@master ~]# kubectl attach -it testos-79778b4895-s8mxl 
[root@testos-79778b4895-s8mxl /]#

# 查看终端日志
[root@master ~]# kubectl logs web-test-7bf98b9576-v566c 
AH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 10.244.4.2. Set the 'ServerName' directive globally to suppress this message

# 删除资源，直接删除POD会自动重建
[root@master ~]# kubectl delete pod testos-79778b4895-s8mxl 
pod "testos-79778b4895-s8mxl" deleted
[root@master ~]# kubectl delete deployments testos
deployment.apps "testos" deleted
```

